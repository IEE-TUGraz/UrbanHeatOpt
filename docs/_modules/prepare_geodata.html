

<!DOCTYPE html>
<html class="writer-html5" lang="python" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>prepare_geodata &mdash; fancy name - tbd 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8cfa8c60"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            fancy name - tbd
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structparam.html">Project Structure and Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runcasestudy.html">Run a Case Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fancy name - tbd</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">prepare_geodata</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for prepare_geodata</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Return</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osmnx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">termcolor</span><span class="w"> </span><span class="kn">import</span> <span class="n">cprint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">data</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="c1">#import fiona</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">transform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>


<div class="viewcode-block" id="get_geodata_from_place">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.get_geodata_from_place">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_geodata_from_place</span><span class="p">(</span><span class="n">place_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get geodata from a place name using the OSMnx library.</span>

<span class="sd">    This function retrieves geodata from a place name using the OSMnx library. The data is filtered for buildings.</span>

<span class="sd">    :param place_name: Location/Place name to get the geodata for. The name of the place must be a valid OSM place name. </span>
<span class="sd">    :type place_name: str</span>
<span class="sd">    :return: A GeoDataFrame containing building data for the specified place. If no data is found, None is returned.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;building&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span> <span class="c1"># Get only buildings</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start: Retrieving geodata for: </span><span class="si">{</span><span class="n">place_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Get the geometry of the place</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">features_from_place</span><span class="p">(</span><span class="n">place_name</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># remove rows with &quot;man_mande&quot; not emtpy, if this column exists</span>
            <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">gdf_raw_geo</span><span class="p">[</span><span class="n">gdf_raw_geo</span><span class="p">[</span><span class="s1">&#39;man_made&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1">#reset index                                              </span>
        <span class="n">gdf_raw_geo</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done: Geodata for </span><span class="si">{</span><span class="n">place_name</span><span class="si">}</span><span class="s2"> successfully retrieved.&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdf_raw_geo</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_geodata_from_polygon">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.get_geodata_from_polygon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_geodata_from_polygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get geodata from a polygon using the OSMnx library.</span>

<span class="sd">    This function retrieves geodata from a polygon using the OSMnx library. The data is filtered for buildings.</span>

<span class="sd">    :param polygon: A shapely polygon object representing the area of interest. The polygon must be a valid shapely polygon.</span>
<span class="sd">    :type polygon: shapely.geometry.polygon.Polygon</span>
<span class="sd">    :return: A GeoDataFrame containing building data for the specified polygon. If no data is found, None is returned.</span>
<span class="sd">    :rtype: _type_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;building&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span> <span class="c1"># Get only buildings</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start: Retrieving geodata for the </span><span class="si">{</span><span class="n">polygon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Get the geometry of the place</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">features_from_polygon</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># remove rows with &quot;man_mande&quot; not emtpy</span>
            <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">gdf_raw_geo</span><span class="p">[</span><span class="n">gdf_raw_geo</span><span class="p">[</span><span class="s1">&#39;man_made&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1">#reset index </span>
        <span class="c1"># set a numeric index</span>
        <span class="n">gdf_raw_geo</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done: Geodata for the polygon </span><span class="si">{</span><span class="n">polygon</span><span class="si">}</span><span class="s2"> successfully retrieved.&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdf_raw_geo</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="geodesic_point_buffer">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.geodesic_point_buffer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">geodesic_point_buffer</span><span class="p">(</span><span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">km</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a geodesic point buffer around a given latitude and longitude.</span>

<span class="sd">    :param lat: Latitude of the center point.</span>
<span class="sd">    :type lat: float</span>
<span class="sd">    :param lon: Longitude of the center point.</span>
<span class="sd">    :type lon: float</span>
<span class="sd">    :param km: Radius of the buffer in kilometers.</span>
<span class="sd">    :type km: float</span>
<span class="sd">    :return: A list of coordinates representing the buffer around the point.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Azimuthal equidistant projection</span>
    <span class="n">aeqd_proj</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_proj4</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;+proj=aeqd +lat_0=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2"> +lon_0=</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2"> +x_0=0 +y_0=0&quot;</span><span class="p">)</span>
    <span class="n">tfmr</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_proj</span><span class="p">(</span><span class="n">aeqd_proj</span><span class="p">,</span> <span class="n">aeqd_proj</span><span class="o">.</span><span class="n">geodetic_crs</span><span class="p">)</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">km</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># distance in metres</span>
    <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="n">tfmr</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">[:]</span></div>


<div class="viewcode-block" id="polygon_by_circle">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.polygon_by_circle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_by_circle</span><span class="p">(</span><span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a polygon representing a circle around a given latitude and longitude.</span>

<span class="sd">    :param lat: Latitude of the center point.</span>
<span class="sd">    :type lat: float</span>
<span class="sd">    :param lon: Longitude of the center point.</span>
<span class="sd">    :type lon: float</span>
<span class="sd">    :param radius: Radius of the circle in kilometers.</span>
<span class="sd">    :type radius: float</span>
<span class="sd">    :raises ValueError: If the radius is negative or greater than 20 km.</span>
<span class="sd">    :return: Returns a polygon representing the circle in the format of a shapely polygon.</span>
<span class="sd">    :rtype: shapely.geometry.polygon.Polygon</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius must be positive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius must be less than 20 km&quot;</span><span class="p">)</span>

    <span class="n">geo_circle</span> <span class="o">=</span> <span class="n">geodesic_point_buffer</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>

    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">geo_circle</span><span class="p">)</span>  
    
    <span class="k">return</span> <span class="n">polygon</span></div>


<div class="viewcode-block" id="extract_relevat_data">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.extract_relevat_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_relevat_data</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the relevant data from the raw geodata that are needed for further analysis. </span>
<span class="sd">    </span>
<span class="sd">    Data that are not available are set to a default value, and a warning is printed. Observe the output in the console to check for missing data and data quality.</span>

<span class="sd">    :param gdf_in: GeoDataFrame with the raw geodata obtained from OSM</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :return: A new GeoDataFrame containing the relevant data for further analysis.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># extract the relevant data from the raw geodata that are needed for further analysis</span>
    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Start: Extracting relevant data from the raw geodata&quot;</span><span class="p">)</span>
    <span class="c1"># copy the gemetry coulumn</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add a unique id for each building</span>
    <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;building_&#39;</span> <span class="o">+</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># add the addr: information if available</span>
    <span class="k">if</span> <span class="s1">&#39;addr:city&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:city&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;addr:city&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added addr:city&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:city&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: addr:city not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;addr:postcode&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:postcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;addr:postcode&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added addr:postcode&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:postcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: addr:postcode not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;addr:street&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:street&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;addr:street&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added addr:street&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:street&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: addr:street not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;addr:housenumber&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:housenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;addr:housenumber&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added addr:housenumber&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;addr:housenumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: addr:housenumber not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
    
    <span class="c1"># add building information if available (according to the OSM wiki)</span>
    <span class="k">if</span> <span class="s1">&#39;building&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added building&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: building not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;building:levels&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building:levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building:levels&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added building:levels&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building:levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: building:levels not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added height&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: height not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;building_flats&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building_flats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building_flats&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added building_flats&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building_flats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: building_flats not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;construction_date&#39;</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;construction_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;construction_date&#39;</span><span class="p">]</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Added construction_date&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;construction_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Warning: construction_date not found in the raw data&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">)</span>

    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Done: Relevant data extracted from the raw geodata&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf_out</span>  </div>



<div class="viewcode-block" id="estimate_data_osm">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.estimate_data_osm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_data_osm</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the required data for the subsequent analysis (e.g. number of floors) just from the OSM data. </span>
<span class="sd">    </span>
<span class="sd">    The function estimates the required data for subsequent analysis. Where not sufficient data is available, the data is estimated from the available data. The estimation is based on the OSM data and might not be accurate, depending on the quality of the OSM data.</span>
<span class="sd">    </span>
<span class="sd">    :param gdf_in: GeoDataFrame containing the relevant data, exracted from the raw geodata.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :return: A new GeoDataFrame containing the estimated building properties for further analysis.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Start: Processing data for building classification&quot;</span><span class="p">)</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[[</span><span class="s1">&#39;building_id&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># get construction year</span>
    <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;construction_date&#39;</span><span class="p">]</span>
    <span class="n">gdf_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span> <span class="c1"># set a numeric value for missing data eaysier handling</span>
    <span class="c1"># ensure that the year of construction is an integer</span>
    <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


    <span class="n">data_avail_year_of_construction</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;construction_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data availability for year of construction: </span><span class="si">{</span><span class="n">data_avail_year_of_construction</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

    <span class="c1"># calculate the projected area of the building</span>
    <span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3035</span><span class="p">)</span><span class="o">.</span><span class="n">area</span>

    <span class="c1"># calculted for how mny buildings the projected area is available</span>
    <span class="n">data_avail_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data availability for projected ground area: </span><span class="si">{</span><span class="n">data_avail_area</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

    <span class="n">average_floor_height</span> <span class="o">=</span> <span class="mf">3.5</span> <span class="c1"># average floor height in m; this is a rough estimation and can be adapted</span>
    <span class="n">small_building_aspect_ratio</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="c1"># average ratio of </span>
    <span class="n">large_building_aspect_ratio</span> <span class="o">=</span> <span class="mi">12</span> <span class="c1"># average ratio of length to width for large buildings; </span>
    <span class="c1"># tbd: a case distinction between small and large buildings could be implemented to improve </span>

    <span class="c1"># get the number of floors </span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># try to get the actual number of floors first</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;building:levels&#39;</span><span class="p">])</span> 
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># as alternative estimate the number of buildings by the average height of a floor</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">average_floor_height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if no information is available, assume the height based on a average ground area to height ratio</span>
                    <span class="c1"># make a distinction between small and large buildings</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">small_building_aspect_ratio</span><span class="o">*</span><span class="n">average_floor_height</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># for large buildings, assume a higher aspect ratio</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">large_building_aspect_ratio</span><span class="o">*</span><span class="n">average_floor_height</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># if no information is available, assume the height based on a average ground area to height ratio</span>
                <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">small_building_aspect_ratio</span><span class="o">*</span><span class="n">average_floor_height</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># for large buildings, assume a higher aspect ratio</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">large_building_aspect_ratio</span><span class="o">*</span><span class="n">average_floor_height</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># set the number of floors to 1 if the estimated number of floors yielded 0; zero number of floors would make the area zero as well</span>
    <span class="n">gdf_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">data_avail_number_of_floors</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building:levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data availability for number of floors: </span><span class="si">{</span><span class="n">data_avail_number_of_floors</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

    <span class="c1"># print average and max number of floors</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average number of floors: </span><span class="si">{</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum number of floors: </span><span class="si">{</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># calculate the number of dwellings</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;building_flats&#39;</span><span class="p">])</span> 
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># if no information is available, assume the number of dwellings based on the size of the building</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">250</span><span class="p">)</span> <span class="c1"># assuming 250 m per dwelling; including that there is a lot of projected area the is  not residnetial area</span>
    
    <span class="n">data_avail_number_of_dwellings</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building_flats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data availability for number of dwellings: </span><span class="si">{</span><span class="n">data_avail_number_of_dwellings</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

    <span class="c1"># get the building category according to the OSM definition: https://wiki.openstreetmap.org/wiki/Key:building</span>

    <span class="c1"># split up multiple entries first</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">multiple_entries</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;building&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiple_entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;house&#39;</span> <span class="c1"># default value as that is the most freuequently used building type</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiple_entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if one entry is a garage or carport and assign it to the secondary building type</span>
            <span class="k">if</span> <span class="s1">&#39;carport&#39;</span> <span class="ow">in</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;garage&#39;</span> <span class="ow">in</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;garages&#39;</span> <span class="ow">in</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="ow">or</span> <span class="s1">&#39;parking&#39;</span> <span class="ow">in</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> 
                <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;garage&#39;</span>
                <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_primary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiple_entries</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="c1">#gdf_in[&#39;building_primary&#39;] = gdf_in[&#39;building&#39;].str.split(&#39;;&#39;, expand=True)[0] </span>
    <span class="c1">#gdf_in[&#39;building_secondary&#39;] = gdf_in[&#39;building&#39;].str.split(&#39;;&#39;, expand=True)[1] </span>

    <span class="c1"># iterate through the building types and assign a category</span>
    <span class="n">ratio_heated_projected_area</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># ratio of heated area to projected area; this value is based on a rough estimation and can be adapted</span>
    <span class="n">ratio_heated_projected_area_PCI</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># ratio of heated area to projected area for PCI buildings; to account for less heating in huge industry sites; this value is based on a rough estimation and can be adapted</span>
    <span class="n">cap_heated_area_SFH</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># maximum heated area for a single family house; to account e.g. for farm houses, with larege area but only partially heated; this value is based on a rough estimation and can be adapted</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;building_primary&#39;</span><span class="p">]:</span>
                <span class="k">case</span> <span class="s1">&#39;apartments&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;barracks&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;bungalow&#39;</span><span class="p">:</span> 
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;cabin&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;detached&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;annexe&#39;</span><span class="p">:</span>  
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;dormitory&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;farm&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;ger&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;hotel&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span> <span class="c1"># assuming a hotel has a similar energy demand as an apartment building</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;house&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;houseboat&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                <span class="k">case</span> <span class="s1">&#39;residential&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                        <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                    <span class="k">elif</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MFH&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;semidetached_house&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;static_caravan&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;stilt_house&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;terrace&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TH&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="s1">&#39;tree_house&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;trullo&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;commercial&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;industrial&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;kiosk&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="k">case</span> <span class="s1">&#39;office&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;retail&#39;</span><span class="p">:</span>  
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;supermarket&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;warehouse&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">case</span> <span class="s1">&#39;civic&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;college&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;fire_station&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;government&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;kindergarten&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;museum&#39;</span><span class="p">:</span>  
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;public&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;school&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;university&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;sports_hall&#39;</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCI&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area_PCI</span>
                <span class="k">case</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> <span class="c1"># this can cause problems, as the &#39;yes&#39; tag is used very inconsistently in OSM, and therefore some buildings can be missmatched!</span>
                    <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SFH&#39;</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                        <span class="k">if</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cap_heated_area_SFH</span><span class="p">:</span>
                            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_heated_area_SFH</span>
                    <span class="k">elif</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MFH&#39;</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AB&#39;</span>
                        <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio_heated_projected_area</span>
                <span class="k">case</span> <span class="n">default</span><span class="p">:</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
                    <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
            <span class="n">gdf_out</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            
    

    <span class="c1"># decrease heating area by parking space which is not heated</span>
    <span class="n">gdf_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_out</span><span class="p">[</span><span class="s1">&#39;building_secondary&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span>
    
    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Done: Data processing for building classification&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gdf_out</span></div>



<div class="viewcode-block" id="merge_other_data">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.merge_other_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_other_data</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is a dummy to merge in other data sources like cadastre data if available.</span>

<span class="sd">    If more accurate building data is available, it can be merged in here. The function is a placeholder for future development and does not do anything at the moment.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :return: A new GeoDataFrame containing the updated and merged building data.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># add code here to merge in other data sources e.g. more accurate building data from the cadastre</span>

    <span class="k">return</span> <span class="n">gdf_out</span></div>



<div class="viewcode-block" id="adjust_num_of_dwelling">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.adjust_num_of_dwelling">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">adjust_num_of_dwelling</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the number of dwellings to 0 for non residential buildings and limit the number of dwellings to a maximum of 500.</span>

<span class="sd">    The number of dwellings is set to 0 for non residential buildings (e.g. PCI) and the number of dwellings is limited to a maximum of 500. This is done to avoid unrealistic values for the number of dwellings.</span>
<span class="sd">    In the subsequent analysis, the number of dwellings is used to calculate the specific heating demand and the yearly heating demand.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#remove the number of dwelling for non residential buildings</span>
    <span class="n">gdf_in</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PCI&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">gdf_in</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># TBD: make that parameterizable</span>
    <span class="c1"># limit the number of dwellings to a maximum of 500</span>
    <span class="n">gdf_in</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span></div>


<div class="viewcode-block" id="remove_zero_area_buildings">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.remove_zero_area_buildings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_zero_area_buildings</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes buildings with a projected area of 0.</span>

<span class="sd">    For buildings with zero area, no further analysis is possible. The buildings are removed from the GeoDataFrame to avoid errors in the subsequent analysis.</span>
<span class="sd">    Most buildings without a projected area might be buildings that are not residential or not heated.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :return: A new GeoDataFrame containing the building data without buildings with a projected area of 0.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="c1">#cprint(&quot;Start: Removing buildings with a projected area of 0&quot;)</span>
    <span class="c1"># delete the building rows with a projected area of 0; when the area is not available at all, no other estimation is possible</span>
    <span class="n">len_before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">)</span>
    <span class="n">gdf_out</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">len_after</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_out</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done: Removed </span><span class="si">{</span><span class="n">len_before</span><span class="o">-</span><span class="n">len_after</span><span class="si">}</span><span class="s2"> buildings with a projected area of zero&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf_out</span></div>

  

<div class="viewcode-block" id="get_spec_HD">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.get_spec_HD">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_spec_HD</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">path_spec_HD</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the specific heating demand of the buildings. </span>

<span class="sd">    The specific heating demand is obtained from the excel file containing the specific heating demand data. </span>
<span class="sd">    The country speccific data can be obtained from the TABULA webtool: https://webtool.building-typology.eu/#bm and has to be adjusted to the format of the excel file.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data, including the year of construction and the building category.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param path_spec_HD: Path to the excel file containing the specific heating demand data.</span>
<span class="sd">    :type path_spec_HD: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># load data for specific heating demand</span>
    <span class="n">spec_HD</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_spec_HD</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># iterate trough all rows and columns in the data</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">spec_HD</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bulding_type</span> <span class="ow">in</span> <span class="n">spec_HD</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1">#print(row, column, data.loc[row, column])</span>
            <span class="n">gdf_in</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;building_category&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bulding_type</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;year_of_construction&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">year</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">),</span> <span class="s1">&#39;specific_HD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_HD</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="n">bulding_type</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_yearly_HD">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.get_yearly_HD">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_yearly_HD</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the yearly heating demand based on the specific heating demand and the heated area</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing specific heating demand and heated area.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;YearlyDemand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;specific_HD&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;heated_area&#39;</span><span class="p">]</span> </div>



<div class="viewcode-block" id="calc_heating_hours">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.calc_heating_hours">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_heating_hours</span><span class="p">(</span><span class="n">case_study_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">Tset</span> <span class="o">=</span> <span class="mf">21.0</span><span class="p">,</span> <span class="n">Tsetback</span><span class="o">=</span><span class="mf">18.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the heating degree hours based on the outside temperature and the setpoint temperature.</span>
<span class="sd">     </span>
<span class="sd">    The heating degree hours are calculated for the whole year, for a reference actitive occupancy profile. </span>

<span class="sd">    :param case_study_name: Name of the case study, used to load the temperature data</span>
<span class="sd">    :type case_study_name: str</span>
<span class="sd">    :param config: Config dictionary</span>
<span class="sd">    :type config: dict</span>
<span class="sd">    :param Tset: Setpoint temperature for buildings, defaults to 21</span>
<span class="sd">    :type Tset: float, optional</span>
<span class="sd">    :param Tsetback: Setback temperature for buildings, defaults to 18</span>
<span class="sd">    :type Tsetback: float, optional</span>
<span class="sd">    :return: Number of heating degree hours for the whole year in C*h </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_temp</span> <span class="o">=</span> <span class="n">load_temp_data</span><span class="p">(</span><span class="n">case_study_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># calculate a generic Tset profile for the year that is Tset from 6 - 22h and Tsetback from 22 - 6h</span>
    <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

    <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Tset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tset</span>
    <span class="n">df_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Tset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsetback</span>
    <span class="n">df_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;Tset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsetback</span>

    <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Tdiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Tset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;T_out&#39;</span><span class="p">]</span>

    <span class="n">heatinghours</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Tdiff&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tdiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 

    <span class="k">return</span> <span class="n">heatinghours</span></div>



<div class="viewcode-block" id="estimate_thermal_properties">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.estimate_thermal_properties">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_thermal_properties</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">heatinghours</span><span class="o">=</span><span class="mf">50000.0</span><span class="p">,</span> <span class="n">speHeatStorCap</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">surface_to_area</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;    Estimate the thermal properties of the buildings based on the specific heating demand and the heated area. </span>
<span class="sd">    </span>
<span class="sd">    The estimated thermal properties are scaled up for the whole building, that means all parameters refere to the total building.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param heatinghours: Number of heating hours per year. Sumed up the temperature difference between setpoint and outside temperature for all hours of the year., defaults to 50000</span>
<span class="sd">    :type heatinghours: float, optional</span>
<span class="sd">    :param speHeatStorCap: specific heat storage capacity of the building material in kWh/mK of a wall of average thickness, defaults to 0.04</span>
<span class="sd">    :type speHeatStorCap: float, optional</span>
<span class="sd">    :param surface_to_area: float ratio of thermal active area of the building (i.e. walls, roof, floor) to the ground area of the building (avoid double counting of indoor walls), defaults to 2.5</span>
<span class="sd">    :type surface_to_area: float, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;GeneralisedThermCond&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;YearlyDemand&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">heatinghours</span>
    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;GeneralisedThermCap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">surface_to_area</span> <span class="o">*</span> <span class="n">speHeatStorCap</span>
    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;MaxDemand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;GeneralisedThermCond&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span> <span class="o">+</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;GeneralisedThermCap&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="c1">#assuming the max heating power to heat at 25 C temp. diff, and be able to rise temp by 2 C per hour</span></div>


<div class="viewcode-block" id="define_setpontTemp">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.define_setpontTemp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">define_setpontTemp</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">temp_setpoint</span> <span class="o">=</span> <span class="mf">22.0</span><span class="p">,</span> <span class="n">std_setpoint</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">temp_setback</span> <span class="o">=</span> <span class="mf">17.0</span><span class="p">,</span> <span class="n">std_setback</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define the setpoint temperature and the setback temperature for the buildings. </span>
<span class="sd">    </span>
<span class="sd">    The values are randomly generated based on a normal distribution around the mean values. If real data is available, this function can be replaced by the real data.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param temp_setpoint: mean value for the setpoint temperature, defaults to 22.0</span>
<span class="sd">    :type temp_setpoint: float, optional</span>
<span class="sd">    :param std_setpoint: standard deviation for the setpoint temperature, defaults to 2.0</span>
<span class="sd">    :type std_setpoint: float, optional</span>
<span class="sd">    :param temp_setback: mean value for the setback temperature, defaults to 17.0</span>
<span class="sd">    :type temp_setback: float, optional</span>
<span class="sd">    :param std_setback: standard deviation for the setback temperature, defaults to 2.0</span>
<span class="sd">    :type std_setback: float, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;temp_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">temp_setpoint</span><span class="p">,</span> <span class="n">std_setpoint</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">))</span>
    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;temp_setback&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">temp_setback</span><span class="p">,</span> <span class="n">std_setback</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">))</span></div>



<div class="viewcode-block" id="estimate_local_heat_prod_costs">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.estimate_local_heat_prod_costs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_local_heat_prod_costs</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">cost_per_kWh</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the local heating production costs based on the cost per kWh.</span>

<span class="sd">    The costs are randomly generated based on a normal distribution around the mean value. If real data is available, this function can be replaced by the real data.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param cost_per_kWh: mean value for the heating costs per kWh, defaults to 0.15</span>
<span class="sd">    :type cost_per_kWh: float, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;LocalHeatProdCosts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">cost_per_kWh</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">)))</span></div>

        

<div class="viewcode-block" id="estimate_internal_gainfactor">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.estimate_internal_gainfactor">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_internal_gainfactor</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">gain_per_dwelling</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the internal gain factor for the buildings.</span>

<span class="sd">    The gain is scaled per dwelling, with the input parameter gain_per_dwelling. </span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param gain_per_dwelling: value for the internal gain per dwelling in kW/dwelling, defaults to 0.2</span>
<span class="sd">    :type gain_per_dwelling: float, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;InternalGainFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;number_of_dwellings&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gain_per_dwelling</span></div>



<div class="viewcode-block" id="estimate_solar_gainfactor">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.estimate_solar_gainfactor">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">estimate_solar_gainfactor</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">window_fraction</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the solar gain factor for the buildings. </span>
<span class="sd">    </span>
<span class="sd">    The gain is scaled per dwelling, with the input parameter window_fraction. If more accurate data is available, this function can be replaced by the real data.</span>

<span class="sd">    :param gdf_in: GeoDataFrame containing the building data.</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param window_fraction: share of window area of total facade area, defaults to 0.1</span>
<span class="sd">    :type window_fraction: float, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># estimate the area of one side of the building and multiply it with the share of the window area</span>
    <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;SolarGainFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;number_of_floors&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdf_in</span><span class="p">[</span><span class="s1">&#39;projected_ground_area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">*</span> <span class="n">window_fraction</span></div>



<div class="viewcode-block" id="write_buildingdata_to_disk">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.write_buildingdata_to_disk">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_buildingdata_to_disk</span><span class="p">(</span><span class="n">gdf_in</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">casestudy</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the building data to disk as a GeoJSON file.</span>

<span class="sd">    The function checks if the directory for the case study exists and creates it if not. The building data is then written to disk in the specified format.</span>
<span class="sd">    :param gdf_in: GeoDataFrame containing the building data</span>
<span class="sd">    :type gdf_in: gpd.GeoDataFrame</span>
<span class="sd">    :param casestudy: name of the casestudy</span>
<span class="sd">    :type casestudy: str</span>
<span class="sd">    :param config: configuration dictionary</span>
<span class="sd">    :type config: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># check if directory exists</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">casestudy</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">gdf_in</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;building_data&#39;</span><span class="p">][</span><span class="s1">&#39;buildings_gdf&#39;</span><span class="p">]),</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Done: Building data written to disk&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span></div>

    
   

<div class="viewcode-block" id="generate_complete_geodataset">
<a class="viewcode-back" href="../modules/prepare_geodata.html#prepare_geodata.generate_complete_geodataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_complete_geodataset</span><span class="p">(</span><span class="n">casstudy_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a complete case study for a given location. </span>
<span class="sd">    </span>
<span class="sd">    The function generates a new case study folder if the folder does not exist yet. </span>
<span class="sd">    It then loads the building data from OpenStreetMap and processes it to get the relevant data.</span>
<span class="sd">    The function estimates the thermal properties of the buildings and writes the data to disk.</span>
<span class="sd">    The function returns the processed building data as a GeoDataFrame.</span>
<span class="sd">    </span>
<span class="sd">    :param casstudy_name: Name of the case study</span>
<span class="sd">    :type casstudy_name: str</span>
<span class="sd">    :param location: Geographical location of the case study. Can be a polygon (must be polygon) or a place name (string).</span>
<span class="sd">    :type location: str or shapely.geometry.polygon.Polygon</span>
<span class="sd">    :return: A GeoDataFrame containing the building data for the case study with all properites.</span>
<span class="sd">    :rtype: gpd.GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># load config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">()</span>

    <span class="c1"># generate a new case study folder if not exists</span>
    <span class="n">generate_new_case_study</span><span class="p">(</span><span class="n">casstudy_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># check if the location is a polygon or a place name</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">):</span>
        <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">get_geodata_from_polygon</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf_raw_geo</span> <span class="o">=</span> <span class="n">get_geodata_from_place</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

    <span class="c1"># Extract the relevant data</span>
    <span class="n">gdf_relevant_data</span> <span class="o">=</span> <span class="n">extract_relevat_data</span><span class="p">(</span><span class="n">gdf_raw_geo</span><span class="p">)</span>
    <span class="c1"># Estimate the data</span>
    <span class="n">gdf_estimated_data</span> <span class="o">=</span> <span class="n">estimate_data_osm</span><span class="p">(</span><span class="n">gdf_relevant_data</span><span class="p">)</span>
    <span class="c1"># Merge other data</span>
    <span class="n">gdf_merged</span> <span class="o">=</span> <span class="n">merge_other_data</span><span class="p">(</span><span class="n">gdf_estimated_data</span><span class="p">)</span>
    <span class="c1"># remove buildings with a projected area of 0</span>
    <span class="n">gdf_complete</span> <span class="o">=</span> <span class="n">remove_zero_area_buildings</span><span class="p">(</span><span class="n">gdf_merged</span><span class="p">)</span> 

    <span class="c1"># adjust the number of dwellings for non residential buildings</span>
    <span class="n">adjust_num_of_dwelling</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">)</span>
    <span class="c1"># Get the specific heating demand</span>
    <span class="n">path_spec_HD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">casstudy_name</span><span class="p">,</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;parameter_dir&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;building_data_dir&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;case_study_data&#39;</span><span class="p">][</span><span class="s1">&#39;building_typology&#39;</span><span class="p">])</span>

    <span class="n">get_spec_HD</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">,</span> <span class="n">path_spec_HD</span><span class="p">)</span>
    <span class="c1"># Get the yearly heating demand</span>
    <span class="n">get_yearly_HD</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">)</span>
    <span class="c1"># estimate the number of heating hours in the year</span>
    <span class="n">heatinghours</span> <span class="o">=</span> <span class="n">calc_heating_hours</span><span class="p">(</span><span class="n">casstudy_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Estimate the thermal properties</span>
    <span class="n">estimate_thermal_properties</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">,</span> <span class="n">heatinghours</span><span class="p">)</span>
    <span class="c1"># Define the setpoint temperature</span>
    <span class="n">define_setpontTemp</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">)</span>
    <span class="c1"># Estimate the local heating production costs   </span>
    <span class="n">estimate_local_heat_prod_costs</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">)</span>
    <span class="c1"># Estimate the internal gain factor</span>
    <span class="n">estimate_internal_gainfactor</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">)</span>
    <span class="c1"># Estimate the solar gain factor</span>
    <span class="n">estimate_solar_gainfactor</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="c1"># Write the building data to disk</span>
    <span class="n">write_buildingdata_to_disk</span><span class="p">(</span><span class="n">gdf_complete</span><span class="p">,</span> <span class="n">casstudy_name</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf_complete</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">casestudy</span> <span class="o">=</span> <span class="s2">&quot;Frauental&quot;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Frauental, Styria, Austria&quot;</span>
    
    <span class="c1"># create a polygon for the location</span>
    <span class="n">generate_complete_geodataset</span><span class="p">(</span><span class="n">casestudy</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> 
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Simon Malacek, David Cardona, Jose Portela.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>